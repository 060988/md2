{"version":3,"file":"data-table.js","sourceRoot":"","sources":["../../../../src/lib/core/data-table/data-table.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ContentChild,\n  ContentChildren,\n  Directive,\n  Input,\n  QueryList,\n  ViewChild,\n  ViewContainerRef,\n  ViewEncapsulation\n} from '@angular/core';\nimport {BehaviorSubject} from 'rxjs/BehaviorSubject';\nimport 'rxjs/add/operator/let';\nimport 'rxjs/add/operator/debounceTime';\nimport 'rxjs/add/observable/combineLatest';\nimport {CollectionViewer, DataSource} from './data-source';\nimport {CdkCellOutlet, CdkHeaderRowDef, CdkRowDef} from './row';\nimport {CdkCellDef, CdkColumnDef, CdkHeaderCellDef} from './cell';\n\n/**\n * Provides a handle for the table to grab the view container's ng-container to insert data rows.\n * @docs-private\n */\n@Directive({selector: '[rowPlaceholder]'})\nexport class RowPlaceholder {\n  constructor(public viewContainer: ViewContainerRef) { }\n}\n\n/**\n * Provides a handle for the table to grab the view container's ng-container to insert the header.\n * @docs-private\n */\n@Directive({selector: '[headerRowPlaceholder]'})\nexport class HeaderRowPlaceholder {\n  constructor(public viewContainer: ViewContainerRef) { }\n}\n\n/**\n * A data table that connects with a data source to retrieve data and renders\n * a header row and data rows. Updates the rows when new data is provided by the data source.\n */\n@Component({\n  selector: 'cdk-table',\n  template: `\n    <ng-container headerRowPlaceholder></ng-container>\n    <ng-container rowPlaceholder></ng-container>\n  `,\n  host: {\n    'class': 'cdk-table',\n    'role': 'grid' // TODO(andrewseguin): Allow the user to choose either grid or treegrid\n  },\n  encapsulation: ViewEncapsulation.None,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class CdkTable implements CollectionViewer {\n  /**\n   * Provides a stream containing the latest data array to render. Influenced by the table's\n   * stream of view window (what rows are currently on screen).\n   */\n  @Input() dataSource: DataSource<any>;\n\n  // TODO(andrewseguin): Remove max value as the end index\n  // and instead calculate the view on init and scroll.\n  /**\n   * Stream containing the latest information on what rows are being displayed on screen.\n   * Can be used by the data source to as a heuristic of what data should be provided.\n   */\n  viewChanged =\n      new BehaviorSubject<{start: number, end: number}>({start: 0, end: Number.MAX_VALUE});\n\n  /**\n   * Map of all the user's defined columns identified by name.\n   * Contains the header and data-cell templates.\n   */\n  private _columnDefinitionsByName = new Map<string,  CdkColumnDef>();\n\n  // Placeholders within the table's template where the header and data rows will be inserted.\n  @ViewChild(RowPlaceholder) _rowPlaceholder: RowPlaceholder;\n  @ViewChild(HeaderRowPlaceholder) _headerRowPlaceholder: HeaderRowPlaceholder;\n\n  /**\n   * The column definitions provided by the user that contain what the header and cells should\n   * render for each column.\n   */\n  @ContentChildren(CdkColumnDef) _columnDefinitions: QueryList<CdkColumnDef>;\n\n  /** Template used as the header container. */\n  @ContentChild(CdkHeaderRowDef) _headerDefinition: CdkHeaderRowDef;\n\n  /** Set of templates that used as the data row containers. */\n  @ContentChildren(CdkRowDef) _rowDefinitions: QueryList<CdkRowDef>;\n\n  constructor(private _changeDetectorRef: ChangeDetectorRef) {\n    console.warn('The data table is still in active development ' +\n        'and should be considered unstable.');\n  }\n\n  ngOnDestroy() {\n    // TODO(andrewseguin): Disconnect from the data source so\n    // that it can unsubscribe from its streams.\n  }\n\n  ngOnInit() {\n    // TODO(andrewseguin): Setup a listener for scroll events\n    //   and emit the calculated view to this.viewChanged\n  }\n\n  ngAfterContentInit() {\n    // TODO(andrewseguin): Throw an error if two columns share the same name\n    this._columnDefinitions.forEach(columnDef => {\n      this._columnDefinitionsByName.set(columnDef.name, columnDef);\n    });\n  }\n\n  ngAfterViewInit() {\n    // TODO(andrewseguin): Re-render the header when the header's columns change.\n    this.renderHeaderRow();\n\n    // TODO(andrewseguin): Re-render rows when their list of columns change.\n    // TODO(andrewseguin): If the data source is not\n    //   present after view init, connect it when it is defined.\n    // TODO(andrewseguin): Unsubscribe from this on destroy.\n    this.dataSource.connect(this).subscribe((rowsData: any[]) => {\n      // TODO(andrewseguin): Add a differ that will check if the data has changed,\n      //   rather than re-rendering all rows\n      this._rowPlaceholder.viewContainer.clear();\n      rowsData.forEach(rowData => this.insertRow(rowData));\n      this._changeDetectorRef.markForCheck();\n    });\n  }\n\n  /**\n   * Create the embedded view for the header template and place it in the header row view container.\n   */\n  renderHeaderRow() {\n    const cells = this.getHeaderCellTemplatesForRow(this._headerDefinition);\n\n    // TODO(andrewseguin): add some code to enforce that exactly\n    // one CdkCellOutlet was instantiated as a result\n    // of `createEmbeddedView`.\n    this._headerRowPlaceholder.viewContainer\n        .createEmbeddedView(this._headerDefinition.template, {cells});\n    CdkCellOutlet.mostRecentCellOutlet.cells = cells;\n    CdkCellOutlet.mostRecentCellOutlet.context = {};\n  }\n\n  /**\n   * Create the embedded view for the data row template and place it in the correct index location\n   * within the data row view container.\n   */\n  insertRow(rowData: any) {\n    // TODO(andrewseguin): Add when predicates to the row definitions\n    //   to find the right template to used based on\n    //   the data rather than choosing the first row definition.\n    const row = this._rowDefinitions.first;\n\n    // TODO(andrewseguin): Add more context, such as first/last/isEven/etc\n    const context = {$implicit: rowData};\n\n    // TODO(andrewseguin): add some code to enforce that exactly one\n    //   CdkCellOutlet was instantiated as a result  of `createEmbeddedView`.\n    this._rowPlaceholder.viewContainer.createEmbeddedView(row.template, context);\n\n    // Insert empty cells if there is no data to improve rendering time.\n    CdkCellOutlet.mostRecentCellOutlet.cells = rowData ? this.getCellTemplatesForRow(row) : [];\n    CdkCellOutlet.mostRecentCellOutlet.context = context;\n  }\n\n  /**\n   * Returns the cell template definitions to insert into the header\n   * as defined by its list of columns to display.\n   */\n  getHeaderCellTemplatesForRow(headerDef: CdkHeaderRowDef): CdkHeaderCellDef[] {\n    return headerDef.columns.map(columnId => {\n      return this._columnDefinitionsByName.get(columnId).headerCell;\n    });\n  }\n\n  /**\n   * Returns the cell template definitions to insert in the provided row\n   * as defined by its list of columns to display.\n   */\n  getCellTemplatesForRow(rowDef: CdkRowDef): CdkCellDef[] {\n    return rowDef.columns.map(columnId => {\n      return this._columnDefinitionsByName.get(columnId).cell;\n    });\n  }\n}\n"]}